#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Copyright (c) [2025] [liuyngchng@hotmail.com] - All rights reserved.
import os
import logging.config

from apps.paper_review.paper_reviewer import PaperReviewer
from common.sys_init import init_yml_cfg


log_config_path = 'logging.conf'
if os.path.exists(log_config_path):
    logging.config.fileConfig(log_config_path, encoding="utf-8")
else:
    from common.const import LOG_FORMATTER
    logging.basicConfig(level=logging.INFO,format= LOG_FORMATTER, force=True)
logger = logging.getLogger(__name__)

def test_fill_formatted_report():

    final_report_txt = """
# 可行性分析报告评审报告

## 评审概述
- 评审时间: 2025-11-19 09:17:58
- 整体评分: 67/100
- 评审结论: 通过

## 整体评价
该文档目前处于不完整状态，核心的技术方案和架构设计内容缺失，导致整体可行性无法评估。需重点补充系统架构、技术选型及需求量化分析，否则项目实施风险极高。

### 主要优势
- 章节结构基本完整，涵盖了引言、总体设计等必要部分
- 部分章节（如术语定义）对基础概念有一定梳理

### 主要问题  
- 核心设计内容严重缺失，系统架构和技术选型章节图表及说明缺失，无法评估方案可行性
- 需求分析深度不足，缺乏具体的功能清单、性能指标和业务场景描述
- 项目背景和目标的论证薄弱，缺乏数据支撑和量化指标
- 设计原则过于泛化，未结合天然气零售业务特点提出具体标准

### 关键建议
- 补充系统架构图、技术选型明细及论证，明确软硬件配置和技术路线
- 细化功能需求和非功能性需求，增加可量化的性能指标（如响应时间、并发用户数等）
- 完善项目背景分析，补充业务痛点具体案例和数据支撑，明确建设必要性
- 增加风险评估章节，识别技术、管理和业务风险并制定应对措施

## 各章节评审结果

### 1. 引言 > 1.1 编写目的
- **评分**: 82/100
- **风险等级**: 中

#### 优点
  - 文档目标阐述清晰，明确了为系统技术实现提供架构蓝图和设计指导的核心定位
  - 读者对象定位准确，覆盖了项目管理人员、开发人员、测试人员、运维人员等关键干系人
  - 文档结构符合概要设计文档的基本规范，章节划分合理

#### 问题
  - 项目背景章节内容缺失，无法评估项目提出的必要性和紧迫性
  - 文档目标描述较为笼统，缺乏与具体业务痛点的直接关联性说明
  - 读者对象部分未明确区分不同角色对文档的具体使用方式和关注重点
  - 缺乏对天然气行业特殊性的考虑，如安全规范、行业标准等专业要素
  - 未提及文档的版本控制、变更管理等相关信息

#### 改进建议
  - 补充项目背景章节，详细说明项目的业务驱动因素、现状问题和建设必要性
  - 在文档目标中增加与业务目标的对应关系，明确如何通过技术方案解决业务痛点
  - 针对不同读者对象，建议增加对应的阅读指南或重点标注，提升文档实用性
  - 增加天然气行业相关标准、规范的引用，体现行业专业性
  - 明确文档的版本历史和变更记录管理机制，确保文档的时效性和可追溯性


### 1. 引言 > 1.2 项目背景
- **评分**: 75/100
- **风险等级**: 中

#### 优点
  - 项目目标明确，从业务数字化、数据可视化、决策智能化三个维度进行了清晰的阐述
  - 业务范围界定清晰，涵盖了气源管理、管网监控、客户服务、经营分析四大核心领域
  - 系统架构设计合理，提出了分层架构思想（数据采集层、业务处理层、决策支持层）

#### 问题
  - 内容完整性不足：缺乏对当前业务痛点和系统问题的具体分析，未说明项目建设的紧迫性和必要性
  - 数据充分性欠缺：建设目标描述较为宏观，缺乏可量化的具体指标（如效率提升百分比、成本降低目标等）
  - 风险识别度不足：未对项目实施可能面临的技术风险、业务变革风险等进行识别和分析
  - 专业规范性待加强：未提及与SCADA等现有系统的集成方案和技术标准要求
  - 范围说明过于简略：仅列出了章节标题1.3，缺乏具体的范围界定内容

#### 改进建议
  - 补充现状分析章节，详细描述当前业务痛点（如数据孤岛、人工操作效率低等）和系统问题
  - 量化建设目标，明确具体指标（如业务流程处理时间缩短X%、数据准确率达到Y%等）
  - 增加风险分析内容，识别技术实施、数据质量、业务适应等主要风险并制定应对措施
  - 明确系统集成范围和技术标准，特别是与SCADA系统的数据接口规范
  - 完善范围说明章节，明确业务范围、组织范围、技术边界和排除范围


### 1. 引言 > 1.3 范围说明
- **评分**: 68/100
- **风险等级**: 中

#### 优点
  - 章节结构清晰，明确划分了系统边界和功能范围
  - 功能范围描述较为全面，涵盖了数据采集、运行监控、统计分析、系统管理等核心模块
  - 明确指出了系统不包含的功能边界，有助于避免范围蔓延

#### 问题
  - 系统边界图表缺失（media/image1.png未提供），无法评估边界定义的准确性
  - 功能描述过于笼统，缺乏具体的功能清单和技术指标量化
  - 未明确系统与其他业务系统（如财务结算、客户服务系统）的集成关系和接口需求
  - 缺乏对非功能性需求（如性能、安全、可靠性等）的具体指标要求
  - 范围说明未与项目背景中的业务问题形成明确对应关系

#### 改进建议
  - 补充系统边界图表，明确标识与外部系统的交互关系和数据流向
  - 将功能范围细化为具体功能点清单，明确每个功能的输入、处理和输出要求
  - 增加非功能性需求章节，明确系统性能指标（如并发用户数、响应时间）、安全等级要求等
  - 明确与财务、客服等相邻系统的集成接口标准和数据交换协议
  - 将功能范围与项目背景中的业务痛点建立映射关系，增强论证逻辑性


### 1. 引言 > 1.4 术语定义
- **评分**: 75/100
- **风险等级**: 中

#### 优点
  - 术语定义覆盖了天然气零售信息系统的核心业务概念（如SCADA、GIS、城市门站、输差分析等）和关键技术概念（如API、IoT、BI等），为后续文档理解提供了基础
  - 术语定义表述清晰，专业性强，体现了对天然气行业信息系统的理解
  - 缩略语部分包含了常见的技术术语，有助于统一技术沟通语言

#### 问题
  - 术语定义章节缺少对核心业务对象（如用户、气量、价格等）的定义，内容完整性有待加强
  - 部分术语定义（如'天然气零信息'）表述不够严谨，更像是理念描述而非精确的术语定义
  - 术语定义与后续系统总体设计的关联性不强，未能体现这些术语在系统设计中的具体应用场景
  - 缺少术语定义的规范性说明（如引用标准、术语来源等）
  - 术语定义部分未考虑系统特有的业务规则相关术语（如计费规则、安全规则等）

#### 改进建议
  - 补充核心业务对象术语定义，如用户分类、气量计量单位、价格策略等关键业务概念
  - 重新审视'天然气零信息'等概念的表述，确保术语定义的准确性和专业性
  - 建立术语与系统功能模块的映射关系，说明各术语在系统设计中的具体应用
  - 增加术语引用标准说明，明确术语定义的依据和来源
  - 补充系统特有的业务规则相关术语，完善业务层面的术语体系


### 2. 系统总体设计 > 2.1 设计原则
- **评分**: 70/100
- **风险等级**: 中

#### 优点
  - 章节结构清晰，明确划分为技术原则和业务原则，覆盖了系统设计的主要维度
  - 技术原则部分涵盖了分层架构、标准化、高可用性、数据一致性、安全性等关键要素，符合行业通用设计规范
  - 业务原则部分强调了用户需求导向、标准化、可扩展性、可靠性、易用性等核心要求，与天然气零售业务特点基本匹配

#### 问题
  - 内容完整性不足：缺乏具体的量化指标和标准要求，如可用性指标（99.9%）、性能响应时间、数据备份周期等
  - 论证逻辑性较弱：原则描述较为泛化，缺乏针对天然气零售业务场景的具体应用说明和逻辑推导
  - 数据充分性缺失：完全缺乏数据支撑，如业务量规模、用户数量、系统并发需求等关键业务数据
  - 专业规范性不足：未提及行业相关标准（如燃气行业信息系统规范、等保要求等），技术描述过于通用
  - 风险识别度不足：未涉及技术选型风险、业务变更风险、数据安全风险等关键风险点的分析

#### 改进建议
  - 补充具体的量化指标，明确系统性能、可用性、安全性等方面的可衡量标准
  - 增加天然气零售业务场景的具体应用案例，说明各项原则如何支撑实际业务需求
  - 补充业务背景数据支撑，如用户规模、交易量、系统并发需求等关键参数
  - 明确引用行业相关标准和规范要求，特别是燃气行业信息系统建设相关标准
  - 增加风险识别章节，分析技术实施、业务适配、数据安全等方面的潜在风险及应对措施


### 2. 系统总体设计 > 2.2 系统架构
- **评分**: 65/100
- **风险等级**: 高

#### 优点
  - 章节结构清晰，按照逻辑架构、物理架构和技术选型进行组织，符合概要设计文档的基本框架要求
  - 提供了图表索引（图表2、图表3），表明已进行初步的架构图形化设计，有助于理解系统结构

#### 问题
  - 内容完整性严重不足：逻辑架构和物理架构章节仅提供了图表索引，但图表内容缺失，无法评估架构设计的合理性、层次划分、组件关系等核心要素
  - 技术选型章节内容完全空白，未列出任何拟采用的技术栈、软件产品、硬件配置或技术路线，无法判断技术方案的可行性和与需求的匹配度
  - 论证逻辑性缺失：由于核心内容（图表和技术选型）缺失，无法评估架构设计是否与项目目标、需求分析形成有效逻辑闭环
  - 数据充分性不足：缺乏对架构决策的说明、技术对比分析或选型依据，无法支撑方案的科学性
  - 专业规范性不足：未遵循架构设计文档应包含架构原则、模式、关键决策点等标准内容，不符合行业规范

#### 改进建议
  - 补充逻辑架构图（图表2）和物理架构图（图表3）的具体内容，并配以文字说明，清晰展示系统层次、模块划分、技术组件及相互关系
  - 在技术选型章节中，详细列出拟采用的软件技术（如前端框架、后端语言、数据库、中间件）、硬件/云资源配置，并说明选型理由及与需求的匹配关系
  - 增加架构设计决策的论证部分，说明为何选择当前架构（如微服务、单体等），以及如何满足性能、安全、扩展性等非功能性需求
  - 明确架构中的关键接口设计、数据流设计及与外部系统的集成方式，确保与技术方案其他部分（如安全、数据治理）的衔接
  - 若图表因格式问题未显示，请在文档中以文字形式简要描述核心架构内容，确保评审可继续推进


### 2. 系统总体设计 > 2.3 技术选型
- **评分**: 45/100
- **风险等级**: 高

#### 优点
  - 章节结构清晰，明确分为开发框架和数据库选型两个部分，便于阅读

#### 问题
  - 内容严重缺失，仅有图表引用而无具体技术选型说明和论证
  - 图表生成失败，导致数据库选型部分内容完全空白
  - 缺乏对技术选型理由、优缺点分析、适用性评估等关键要素的阐述
  - 未提及与系统非功能性需求（如性能、安全、可扩展性）的匹配度
  - 未考虑信创合规要求等政策性约束

#### 改进建议
  - 补充详细的文字说明，阐述选择各技术栈（如前端框架、后端框架、数据库等）的具体原因、优缺点分析及与业务需求的匹配关系
  - 修复或重新生成数据库选型图表，确保技术路线清晰可读
  - 增加技术选型与系统高性能、高并发、数据安全等非功能性需求的关联论证
  - 明确技术选型是否满足信创要求，如使用国产化替代方案或兼容性评估
  - 建议增加技术选型的备选方案对比及风险评估内容


## 评审说明
本评审报告由AI系统生成，建议结合专家人工评审最终确定。
    """

    review_criteria_markdown_data = """
## 📊 工作表: 专家评审意见表

> ⚠️ **表格预览** (复杂表格建议查看原文件)

| 信息化项目可研报告专家评审意见表   | Unnamed: 1                                         | Unnamed: 2   | Unnamed: 3   |
|:-------------------|:---------------------------------------------------|:-------------|:-------------|
| 审查人：               |                                                    | 审查日期：        |              |
| 项目名称               |                                                    |              |              |
| 项目类别               |                                                    | 项目总投资（万元）    |              |
| 项目申报单位             |                                                    |              |              |
| 项目总体判断             |                                                    |              |              |
| 打分项                | 打分标准                                               |              | 分值           |
| 项目目标               | - 合理明确：与痛点问题关联性强，目标明确（8-10 分）                      |              |              |
| （10 分）             | - 基本明确：与痛点问题有关联，目标基本明确（4-7 分）                      |              |              |
|                    | - 目标模糊：无关联，无明确目标（0-3 分）                            |              |              |
| 需求分析               | - 全面具体：功能性需求覆盖全面，描述清晰，非功能性需求指标清晰（16-20 分）          |              |              |
| （20 分）             | - 基本全面：功能性需求覆盖核心场景，描述较清晰；非功能性需求部分指标未量化（11-15 分）    |              |              |
|                    | - 模糊不足：需求缺失，有歧义，非功能性需求无法支撑方案设计（0-10 分）             |              |              |
| 实施条件               | - 条件完备：业务流程完整、组织架构清晰、数据无缺失；技术储备成熟（11-15 分）         |              |              |
| （15 分）             | - 基本具备：业务流程少量缺失、组织架构待完善、数据有缺口；技术储备不足（6-10 分）       |              |              |
|                    | - 条件不足：业务流程、组织架构未完成梳理，核心数据缺失；无技术储备（0-5 分）          |              |              |
| 项目方案               | - 合理可行：建设模式、软硬件架构、技术选型合理，安全方案覆盖全面（16-20 分）         |              |              |
| （20 分）             | - 基本合理：建设模式、软硬件架构、技术选型基本合理，安全方案需完善（11-15 分）        |              |              |
|                    | - 不合理：建设模式、软硬件架构、技术选型不合理，安全方案无效（0-10 分）            |              |              |
| 投资合理性              | - 合理：预算构成覆盖所有实施环节，无遗漏；分项报价与需求关联清晰；工作量测算合理（11-15 分） |              |              |
| （15 分）             | - 基本合理：预算构成覆盖核心实施环节；分项报价与核心需求匹配；工作量测算基本合理（6-10 分）  |              |              |
|                    | - 不合理：预算构成不完整，缺少关键实施环节；预算与需求无明确关联；工作量不合理（0-5 分）    |              |              |
|                    | 各分项预算调整建议：                                         |              |              |
|                    | 1、_软件开发实施_____部分，预算 不合理 ，建议调整至______；       |              |              |
|                    | 2、______部分，预算 合理/不合理 ，建议调整至______；                 |              |              |
|                    | 3、______部分，预算 合理/不合理 ，建议调整至______；                 |              |              |
|                    | 4、______部分，预算 合理/不合理 ，建议调整至______；                 |              |              |
|                    | 预算总额建议调整至____左右__                                  |              |              |
| 产生效益               | - 效益显著：直接效益显著，有数据支撑；间接效益提升效果明显（8-10 分）             |              |              |
| （10 分）             | - 效益一般：直接效益、间接效益一般，无数据支撑（4-7 分）                    |              |              |
|                    | - 效益缺失：无明显直接效益、间接效益（0-3 分）                         |              |              |
| 实施风险               | - 低风险：（8-10 分）                                     |              |              |
| （10 分）             | - 中风险：（4-7 分）                                      |              |              |
|                    | - 高风险：（0-3 分）                                      |              |              |
| 总分                 | 注：                                                 |              |              |
| （100 分）            | 总分≥70分，可研报告质量基本合格，项目实施风险较小，可开展后续实施工作；              |              |              |
|                    | 总分＜70 分，可研报告未达到质量标准，项目实施风险很大，需要继续完善。               |              |              |
| 项目风险               | 项目核心风险与问题阐述：                                       |              |              |
| 专家审查意见总结           | 具体意见建议：                                            |              |              |

## 📊 工作表: 审查意见

> ⚠️ **表格预览** (复杂表格建议查看原文件)

| 信息化项目可研报告审查意见          | Unnamed: 1               | Unnamed: 2   | Unnamed: 3                                                               | Unnamed: 4   |
|:-----------------------|:-------------------------|:-------------|:-------------------------------------------------------------------------|:-------------|
| 项目名称                   | 燃气安全智慧管理平台               |              |                                                                          |              |
| 对应可研报告章节               | 审查点（*关键审查点）              |              | 审查要求                                                                     | 问题及修改意见      |
|                        |                          |              |                                                                          | （请专家逐项审查）    |
| 1.概述                   | 1.1 术语定义                 |              | -                                                                        |              |
|                        | 1.2 编制依据                 |              | 编制依据是否充分、有效，是否能支撑项目立项及后续建设。                                              |              |
|                        | 1.3 项目交流情况               |              | 交流成果是否对项目立项及后续工作有实际指导意义。                                                 |              |
| 2.项目背景                 | 2.1 项目提出背景               | *            | 1.项目背景分析是否深入、客观，是否准确反映项目建设的外部环境、行业趋势及自身需求；                               |              |
|                        |                          |              | 2.是否清晰阐述项目建设的必要性和紧迫性，能否支撑项目立项。                                           |              |
| 立项依据是否充分               |                          |              |                                                                          |              |
|                        | 2.2 业务和系统问题              | *            | 1.业务及系统存在的问题是否梳理全面、清晰；                                                   |              |
|                        |                          |              | 2.问题描述是否具体、准确，是否有数据或实例支撑；                                                |              |
|                        |                          |              | 3.问题分析是否深入，能否找准问题根源，为后续解决方案提供依据。                                         |              |
|                        | 2.3 预期目标                 | *            | 1.预期目标是否明确、具体；                                                           |              |
|                        |                          |              | 2.预期目标是否具有可行性，是否与项目资源、技术能力等相匹配；                                          |              |
|                        |                          |              | 3.预期目标是否与业务发展需求相契合，能否有效解决业务及系统存在的问题；                                     |              |
|                        | 2.4 项目范围                 | *            | 1.项目业务范围是否明确、清晰；                                                         |              |
|                        |                          |              | 2.项目组织范围是否明确、清晰；                                                         |              |
|                        |                          |              | 3.项目推广范围和深度是否明确、清晰；                                                      |              |
|                        |                          |              | 4.项目集成范围是否明确、清晰。                                                         |              |
| 3.现状分析                 | 3.1 业务现状                 | *            | 1.业务流程描述是否清晰、完整，是否涵盖项目涉及的所有核心业务环节；                                       |              |
|                        |                          |              | 2.业务组织架构、职责是否明确；                                                         |              |
| 实施条件是否成熟               |                          |              | 3.业务量、业务增长率等关键业务指标是否明确，数据是否准确；                                           |              |
|                        |                          |              | 4.现有业务模式存在的优势与不足是否分析到位。                                                  |              |
|                        | 3.2 信息化应用现状              | *            | 1.现有信息化系统的功能、性能、架构等是否描述清晰；                                               |              |
|                        |                          |              | 2.现有信息化系统的使用情况，包括用户数量、使用频率、数据量等是否明确；                                     |              |
|                        |                          |              | 3.现有信息化系统与业务的匹配度，能否满足当前业务需求；                                             |              |
|                        |                          |              | 4.现有信息化系统存在的技术瓶颈、安全隐患等问题是否梳理清楚。                                          |              |
| 4.需求分析                 | 4.1 业务及功能需求              | *            | 业务需求质量：                                                                  |              |
|                        |                          |              | 1.业务需求是否具体、无歧义、可验证和可度量，是否覆盖项目涉及的所有业务场景；                                  |              |
| 需求是否清晰、准确、完整           |                          |              | 2.功能需求是否与业务需求紧密结合，能否支撑业务流程的正常运行；                                         |              |
|                        |                          |              | 3.功能需求描述是否详细、具体，包括输入、输出、处理逻辑等                                            |              |
|                        |                          |              | 4.功能需求点前后逻辑是否清晰，易于识别各功能需求之间的关联；                                          |              |
|                        |                          |              | 5.功能需求点与成本估算有对应关系；                                                       |              |
|                        |                          | *            | 业务和功能架构设计：                                                               |              |
|                        |                          |              | 1.提供业务架构、功能架构和集成关系图，能够体现业务管理全局，形成业务需求总览，对应说明各部分需求；                       |              |
|                        |                          |              | 2.功能架构图是否体现出各部分功能建设状态，用不同颜色标注本期项目建设内容设计的新增、优化功能。                         |              |
|                        |                          |              | 3.预建设系统与相关系统关联和定位清晰；                                                     |              |
|                        |                          | *            | 系统集成需求：                                                                  |              |
|                        |                          |              | 1、本系统与其它系统接口需求清晰                                                         |              |
|                        |                          |              | 2、对接系统状态、数据现状、关联业务方面已经确认对接且具备接入条件具备。                                     |              |
|                        |                          | *            | 隐性需求挖掘：包括数据治理、功能和数据关联、电脑端和移动端一致性匹配、智能化预判和提醒；                             |              |
|                        |                          |              | 易用性需求：包括了用户交互界面体验与用户数据查询便捷等要求。                                           |              |
|                        |                          | *            | 数据治理需求：                                                                  |              |
|                        |                          |              | 1、是否准确、全面阐述了数据治理工作的内容，包括：数据标准、数据质量、数据共享、数据安全和数据应用等主要内容。                  |              |
|                        |                          |              | 2、数据治理的责任边界清晰，甲乙双方责任清晰；                                                  |              |
|                        | 4.2 非功能性需求               | *            | 性能需求：根据业务情况，性能需求是否匹配业务发展需要，性能指标设计是否合理。                                   |              |
|                        |                          | *            | 安全需求：安全性需求是否合理、是否遗漏，包括等级保护要求、密码要求、数据库安全要求、开发安全要求、备份需求和数据安全等要求。           |              |
|                        |                          | *            | 运行环境：                                                                    |              |
|                        |                          |              | 1.可靠性需求是否明确，如系统可用性、容错能力、数据备份与恢复等要求；                                      |              |
|                        |                          |              | 2.可扩展性、可维护性、兼容性等其他非功能性需求是否合理、明确。                                         |              |
|                        |                          | *            | 系统运维：                                                                    |              |
|                        |                          |              | 1.是否具备灵活的权限管理、操作审计等安全功能；                                                 |              |
|                        |                          |              | 2.是否提供清晰的监控告警、故障定位、统计分析等功能。                                              |              |
|                        |                          | *            | 开发技术要求：                                                                  |              |
|                        |                          |              | 1.是否明确提出集团系统开发过程管理和技内容；                                                  |              |
|                        |                          |              | 2.提出的系统开发过程管理和技术内容是否符合集团开发标准。                                            |              |
|                        |                          | *            | 数据管理需求：是否全面、合理提出数据资源需求，包括：数据库版本、数据高可用要求、数据存储周期、数据归档周期、数据灾备要求等。           |              |
|                        |                          |              | 信创相关要求：明确本项目是否需要采用信创清单内产品。                                               |              |
| 5.建设条件分析               | 5.1 业务条件分析               |              | 1.现有业务流程、组织架构等是否能够适应项目建设后的变化，是否需要调整；                                     |              |
|                        |                          |              | 2.业务数据是否完整、准确，能否为项目建设提供数据支撑；                                             |              |
| 建设条件是否充分               |                          |              | 3.业务部门对项目的支持力度是否足够，是否有明确的业务需求和配合意愿。                                      |              |
|                        | 5.2 技术条件分析               |              | 1.现有技术基础设施是否能够满足项目建设需求，如服务器、网络、存储等硬件设备；                                  |              |
|                        |                          |              | 2.项目所需的关键技术是否成熟、可行，是否有相应的技术团队和技术支持；                                      |              |
|                        |                          |              | 3.技术风险是否进行了充分评估，有无应对措施。                                                  |              |
| 6.技术方案设计               | 核心建设内容1：                 | *            | 建设模式：                                                                    |              |
|                        |                          |              | 1.建设模式选择是否合理，如成熟产品模式/定制开发模式/混合模式等模式是否符合项目实际情况；                           |              |
| 技术方案是否科学、合理            | 生产运行系统升级功能开发             |              | 2.建设模式的优缺点是否进行了充分分析，是否有相应的风险应对措施；                                        |              |
|                        |                          |              | 3.建设模式是否有利于项目进度、质量和成本的控制；                                                |              |
|                        |                          |              | 4.项目采用成熟产品时，需列出拟采用的所有产品名称及数量。                                            |              |
|                        |                          | *            | 软件方案：                                                                    |              |
|                        |                          |              | 1.软件架构设计是否合理，是否具有良好的扩展性、可维护性和安全性；                                        |              |
|                        |                          |              | 2.软件功能模块划分是否清晰，是否与业务需求和功能需求相匹配；                                          |              |
|                        |                          |              | 3.软件开发技术选型是否合适，是否成熟、稳定；                                                  |              |
|                        |                          |              | 4.软件接口设计是否规范，能否实现与其他系统的有效集成。                                             |              |
|                        |                          | *            | 硬件方案：                                                                    |              |
|                        |                          |              | 1.云资源架构设计是否合理，是否满足业务架构、数据架构与应用架构要求；                                      |              |
|                        |                          |              | 2.对于云计算资源、存储资源和网络资源配置是否完整，资源设计是否齐全。                                      |              |
|                        |                          | *            | 安全方案：                                                                    |              |
|                        |                          |              | 1.安全方案是否全面，是否覆盖物理安全、网络安全、数据安全、应用安全等各个方面；                                 |              |
|                        |                          |              | 2.安全防护措施是否有效，如防火墙、入侵检测系统、数据加密等技术的应用是否合理；                                 |              |
|                        |                          |              | 3.系统等保等级是否符合国家及行业相关安全标准和规范。                                              |              |
|                        |                          | *            | 资源需求：                                                                    |              |
|                        |                          |              | 1.给出需要采购的资源需求，包括：计算、存储、网络等基础设施的配置要求；                                     |              |
|                        |                          |              | 2.软件资源需求，包括：操作系统、数据库、中间件等；                                               |              |
|                        |                          |              | 3.给出需要采购的数据资源、数据服务等需求。                                                   |              |
|                        | 核心建设内容2：                 | *            | 建设模式：                                                                    |              |
|                        |                          |              | 1.建设模式选择是否合理，如成熟产品模式/定制开发模式/混合模式等模式是否符合项目实际情况；                           |              |
|                        | 腐控管理系统升级功能开发             |              | 2.建设模式的优缺点是否进行了充分分析，是否有相应的风险应对措施；                                        |              |
|                        |                          |              | 3.建设模式是否有利于项目进度、质量和成本的控制；                                                |              |
|                        |                          |              | 4.项目采用成熟产品时，需列出拟采用的所有产品名称及数量。                                            |              |
|                        |                          | *            | 软件方案：                                                                    |              |
|                        |                          |              | 1.软件架构设计是否合理，是否具有良好的扩展性、可维护性和安全性；                                        |              |
|                        |                          |              | 2.软件功能模块划分是否清晰，是否与业务需求和功能需求相匹配；                                          |              |
|                        |                          |              | 3.软件开发技术选型是否合适，是否成熟、稳定；                                                  |              |
|                        |                          |              | 4.软件接口设计是否规范，能否实现与其他系统的有效集成。                                             |              |
|                        |                          | *            | 硬件方案：                                                                    |              |
|                        |                          |              | 1.云资源架构设计是否合理，是否满足业务架构、数据架构与应用架构要求；                                      |              |
|                        |                          |              | 2.对于云计算资源、存储资源和网络资源配置是否完整，资源设计是否齐全。                                      |              |
|                        |                          | *            | 安全方案：                                                                    |              |
|                        |                          |              | 1.安全方案是否全面，是否覆盖物理安全、网络安全、数据安全、应用安全等各个方面；                                 |              |
|                        |                          |              | 2.安全防护措施是否有效，如防火墙、入侵检测系统、数据加密等技术的应用是否合理；                                 |              |
|                        |                          |              | 3.系统等保等级是否符合国家及行业相关安全标准和规范。                                              |              |
|                        |                          | *            | 资源需求：                                                                    |              |
|                        |                          |              | 1.给出需要采购的资源需求，包括：计算、存储、网络等基础设施的配置要求；                                     |              |
|                        |                          |              | 2.软件资源需求，包括：操作系统、数据库、中间件等；                                               |              |
|                        |                          |              | 3.给出需要采购的数据资源、数据服务等需求。                                                   |              |
|                        | 核心建设内容3：                 | *            | 建设模式：                                                                    |              |
|                        |                          |              | 1.建设模式选择是否合理，如成熟产品模式/定制开发模式/混合模式等模式是否符合项目实际情况；                           |              |
|                        | 智慧决策功能开发                 |              | 2.建设模式的优缺点是否进行了充分分析，是否有相应的风险应对措施；                                        |              |
|                        |                          |              | 3.建设模式是否有利于项目进度、质量和成本的控制；                                                |              |
|                        |                          |              | 4.项目采用成熟产品时，需列出拟采用的所有产品名称及数量。                                            |              |
|                        |                          | *            | 软件方案：                                                                    |              |
|                        |                          |              | 1.软件架构设计是否合理，是否具有良好的扩展性、可维护性和安全性；                                        |              |
|                        |                          |              | 2.软件功能模块划分是否清晰，是否与业务需求和功能需求相匹配；                                          |              |
|                        |                          |              | 3.软件开发技术选型是否合适，是否成熟、稳定；                                                  |              |
|                        |                          |              | 4.软件接口设计是否规范，能否实现与其他系统的有效集成；                                             |              |
|                        |                          | *            | 硬件方案：                                                                    |              |
|                        |                          |              | 1.云资源架构设计是否合理，是否满足业务架构、数据架构与应用架构要求；                                      |              |
|                        |                          |              | 2.对于云计算资源、存储资源和网络资源配置是否完整，资源设计是否齐全。                                      |              |
|                        |                          | *            | 安全方案：                                                                    |              |
|                        |                          |              | 1.安全方案是否全面，是否覆盖物理安全、网络安全、数据安全、应用安全等各个方面；                                 |              |
|                        |                          |              | 2.安全防护措施是否有效，如防火墙、入侵检测系统、数据加密等技术的应用是否合理；                                 |              |
|                        |                          |              | 3.系统等保等级是否符合国家及行业相关安全标准和规范。                                              |              |
|                        |                          | *            | 资源需求：                                                                    |              |
|                        |                          |              | 1.给出需要采购的资源需求，包括：计算、存储、网络等基础设施的配置要求；                                     |              |
|                        |                          |              | 2.软件资源需求，包括：操作系统、数据库、中间件等；                                               |              |
|                        |                          |              | 3.给出需要采购的数据资源、数据服务等需求。                                                   |              |
|                        | 核心建设内容4：                 | *            | 建设模式：                                                                    |              |
|                        |                          |              | 1.建设模式选择是否合理，如成熟产品模式/定制开发模式/混合模式等模式是否符合项目实际情况；                           |              |
|                        | 管网基础数据共享服务功能开发（含模型管理和落地） |              | 2.建设模式的优缺点是否进行了充分分析，是否有相应的风险应对措施；                                        |              |
|                        |                          |              | 3.建设模式是否有利于项目进度、质量和成本的控制；                                                |              |
|                        |                          |              | 4.项目采用成熟产品时，需列出拟采用的所有产品名称及数量。                                            |              |
|                        |                          | *            | 软件方案：                                                                    |              |
|                        |                          |              | 1.软件架构设计是否合理，是否具有良好的扩展性、可维护性和安全性；                                        |              |
|                        |                          |              | 2.软件功能模块划分是否清晰，是否与业务需求和功能需求相匹配；                                          |              |
|                        |                          |              | 3.软件开发技术选型是否合适，是否成熟、稳定；                                                  |              |
|                        |                          |              | 4.软件接口设计是否规范，能否实现与其他系统的有效集成。                                             |              |
|                        |                          | *            | 模型方案：                                                                    |              |
|                        |                          |              | 1、明确模型的名称、类型、作用、来源（自研/采购/调用第三方API）、产权、付费否；                               |              |
|                        |                          |              | 2、模型的技术路线是否明晰；                                                           |              |
|                        |                          |              | 3、模型所需要的条件是否满足：数据来源保障、质量满足度、治理工作等；部署位置、运行资源等；                            |              |
|                        |                          |              | 4、模型的准确率、召回率、响应时间等关键指标是否有明确的要求和预期值                                       |              |
|                        |                          |              | 4、是否有模型监控功能；问题反馈闭环和持续优化的保障要求；                                            |              |
|                        |                          | *            | 硬件方案：                                                                    |              |
|                        |                          |              | 1.云资源架构设计是否合理，是否满足业务架构、数据架构与应用架构要求；                                      |              |
|                        |                          |              | 2.对于云计算资源、存储资源和网络资源配置是否完整，资源设计是否齐全。                                      |              |
|                        |                          | *            | 安全方案：                                                                    |              |
|                        |                          |              | 1.安全方案是否全面，是否覆盖物理安全、网络安全、数据安全、应用安全等各个方面；                                 |              |
|                        |                          |              | 2.安全防护措施是否有效，如防火墙、入侵检测系统、数据加密等技术的应用是否合理；                                 |              |
|                        |                          |              | 3.系统等保等级是否符合国家及行业相关安全标准和规范。                                              |              |
|                        |                          | *            | 资源需求：                                                                    |              |
|                        |                          |              | 1.给出需要采购的资源需求，包括：计算、存储、网络等基础设施的配置要求；                                     |              |
|                        |                          |              | 2.软件资源需求，包括：操作系统、数据库、中间件等；                                               |              |
|                        |                          |              | 3.给出需要采购的数据资源、数据服务等需求。                                                   |              |
| 7.实施方案建议               | 7.1企业内部团队及职责             | *            | 1.内部项目实施团队组建是否合理，人员配备是否充足；                                               |              |
|                        |                          |              | 2.团队各成员及相关方的职责划分是否清晰、明确，无交叉或遗漏。                                          |              |
| 实施方案中资源、计划和采购方式是否科学、合理 |                          |              |                                                                          |              |
|                        | 7.2参与人员及分工               | *            | 1.参加人员的选择是否合理，是否涵盖项目实施所需的各专业人员；                                          |              |
|                        |                          |              | 2.参加人员的分工是否明确、具体，能否充分发挥各自的优势；                                            |              |
|                        |                          |              | 3.人员分工是否与项目阶段划分和工作任务相匹配。                                                 |              |
|                        | 7.3阶段划分、建设工期和工作量测算       | *            | 1.项目阶段划分是否合理，各阶段的工作任务和目标是否明确；                                            |              |
|                        |                          |              | 2.建设工期安排是否科学，是否考虑了各种影响因素，如节假日、外部环境等；                                     |              |
|                        |                          |              | 3.阶段之间的衔接是否顺畅，有无明确的里程碑节点和交付物。                                            |              |
|                        | 7.4项目采购方式                | *            | 1.项目采购方式选择是否符合国家及企业相关采购政策和规定；                                            |              |
|                        |                          |              | 2.采购范围和内容是否明确，是否涵盖项目所需的所有设备、软件和服务。                                       |              |
| 8.投资估算                 | 8.1 投资测算的完整性             | *            | 全面评估项目实施涉及的各部分预算，包括建设投资外，同步提出后期运营费用估算，包括：软件授权、系统开发、数据治理、资源租用、运维费用、通讯费用等。 |              |
|                        |                          |              |                                                                          |              |
| 项目投资是否合理、经济            |                          |              |                                                                          |              |
|                        | 8.2 投资的合理性               | *            | 投资/费用细项单价合理，构成合理                                                         |              |
|                        |                          |              | 1、按照项目实施各阶段投入人员角色、技术等级，评估对应工作量进行报价。                                      |              |
|                        |                          |              | 2、建设部分，按功能模块拆分进行分项报价                                                     |              |
|                        |                          |              | 3、软硬件购置，明确授权使用时间。                                                        |              |
| 9.预期成果及成果形式            | -                        |              | 1.预期成果是否明确、具体，是否与项目建设目标相匹配；                                              |              |
|                        |                          |              | 2.成果形式是否多样、合理，如软件系统、硬件设备、文档资料等；                                          |              |
|                        |                          |              | 3.预期成果的质量标准是否明确，能否进行有效衡量；                                                |              |
|                        |                          |              | 4.预期成果的交付时间和交付方式是否明确。                                                    |              |
| 10.效益和风险               | 10.1效益分析                 | *            | 1.直接效益分析是否合理，包括成本节约、收入增加、投资回报率等指标的测算是否准确；                                |              |
|                        |                          |              | 2.间接效益分析是否全面，如提升服务质量、改善公共安全、促进行业发展等方面的描述是否充分；                            |              |
|                        |                          |              | 3.效益分析的假设条件是否合理，有无敏感性分析。                                                 |              |
|                        | 10.2风险分析                 | *            | 1.风险识别是否全面，是否涵盖政策风险、技术风险、市场风险、管理风险等各类风险；                                 |              |
|                        |                          |              | 2.风险评估是否准确，对风险发生的可能性和影响程度的判断是否合理；                                        |              |
|                        |                          |              | 3.风险应对措施是否具体、可行，能否有效降低风险发生的概率和影响程度。                                      |              |

    """
    review_topic = "天然气零售系统概要设计评审"
    review_file_path = "/home/rd/Downloads/3.docx"
    my_cfg = init_yml_cfg("/home/rd/workspace/llm_agent/apps/paper_review/cfg.yml")
    paper_reviewer = PaperReviewer(
        1,
        1,
        review_topic,
        review_criteria_markdown_data,
        review_file_path,
        my_cfg
    )
    result = paper_reviewer.fill_all_formatted_markdown_report_with_final_report(final_report_txt)
    result = paper_reviewer.fill_md_table()
    output_file = 'formatted_report.md'
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(result)
    logger.info(f"file output {os.path.abspath(output_file)}")



if __name__ == "__main__":
    test_fill_formatted_report()
