

## 1. 功能

该系统支持语音输入，输出与问题相关的数据表格，并进行图表渲染，系统功能点如表 1-1 所示。

**表 1-1 系统功能点**

| **No** | **功能点**        | **功能说明**                                               |
| ------ | ----------------- | ---------------------------------------------------------- |
| 1      | 自然语言转SQL语句 | 通过大模型将自然语言翻译成 SQL语句，这是这个系统的核心价值 |
| 2      | 数据表绘图        | 通过chart.js 将数据内容绘制成可视化的饼图、柱状图、曲线图  |
| 3      | 语音输入          | 支持通过语音输入问题，实现用户通过语音交互                 |

## 2. 数据源

系统读取的数据源用户可自行配置， 若用户没有配置数据源，则使用系统内置的样例数据。数据源中的表结构样例如表 2-1 所示。

 **表 1-2 表结构 demo**

| **字段名**   | **字段类型** | **字段注释**                 |
| ------------ | ------------ | ---------------------------- |
| id           | INTEGER      | 天然气零售订单信息表         |
| 订单ID       | INTEGER      | 天然气销售订单的唯一编号     |
| 省           | VARCHAR(32)  | 中国国内的省份               |
| 公司名称     | VARCHAR(128) | 进行天然气销售的各个公司名称 |
| 商品名称     | VARCHAR(128) | 具体销售的天然气产品         |
| 年           | INTEGER      | 年份                         |
| 月           | INTEGER      | 订单形成的具体月份           |
| 创建时间     | VARCHAR(64)  | 订单创建时间                 |
| 支付方式     | VARCHAR(64)  | 通过什么渠道进行的资金支付   |
| 支付金额     | VARCHAR(64)  | 具体支付的金额               |
| 支付金额单位 | VARCHAR(32)  | None                         |

就目前LLM 的能力， 如果想达到较好的效果，需要注意以下几点。

（1）表的数量尽量少。

（2）表名、表字段名称尽量使用汉字。

（3）字段类型尽可能简单，如数字、字符串。

（4）字段信息尽可能冗余，不需要考虑3NF约束。例如，表1-2中的字段 “年”、“月” 和 “创建时间” 的关系。

（5）表结构信息需要有自明性，即将表结构给一个完全不懂业务的人看，他可以看明白数据的含义。达到这样的程序，基本上才能让LLM明白。例如，表1-2中的 “支付金额” 字段和“支付金额单位”的关系。

## 3. 核心功能

将自然语言转换为SQL语句，一共需要如下几个步骤。

（1）建立详细的表结构。

（2）将表结构提交给大模型。

（3）将需要问的问题提交给大语言模型。

（4）获取大语言模型返回的SQL。

（5）使用SQL查询数据。