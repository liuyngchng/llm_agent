<center><h1>用户使用手册</h1></center>

# 1. 文档生成系统

## 1.1 系统简介

文档生成系统是一个基于人工智能的自动化文档生成平台，能够根据用户提供的文档结构和内容要求，自动生成各类文档。系统支持多种输入方式，包括自动生成目录结构、上传Word模板以及基于批注的文档修改等功能。

## 1.2 功能特性

- 自动生成文档目录结构
- 支持Word模板上传和处理
- 支持段落批注智能处理
- 集成知识库向量检索功能
- 支持`Mermaid`图表自动生成
- 实时进度跟踪和任务管理

## 1.3 用户侧系统要求
 本地计算机安装有Chrome浏览器，使用Chrome 浏览器访问服务地址即可。

## 1.4 服务侧系统要求
    系统支持用户部署在自己的本地计算机上， 针对在自己机器上上安装软件，并配置环境变量。
### 1.4.1 软件依赖
```bash
python 3.12.3

pip install python-docx cairosvg flask chromadb openai langchain
```


### 1.4.2 字体支持（中文）
```bash
# 安装常用的中文字体包
sudo apt update
sudo apt install fonts-wqy-microhei fonts-wqy-zenhei fonts-noto-cjk

# 安装字体工具
sudo apt install fontconfig

# 刷新字体缓存
fc-cache -fv
```


## 1.5 使用流程

### 1.5.1 登录系统
访问系统登录页面，输入用户名和密码进行身份验证。首次使用需要先注册账户。

### 1.5.2 创建新文档任务
在主界面选择"新建文档"，进入文档创建流程。

#### 1.5.2.1 填写基本信息
- **文档类型**：选择文档类型（如可行性研究报告、技术方案等）
- **文档标题**：输入文档标题
- **关键词**：输入文档相关的关键词或特殊要求

#### 1.5.2.2 选择目录生成方式
系统支持三种目录生成方式：

（1） 方式一：系统自动生成。 系统根据文档类型和标题智能生成三级目录结构。

（2） 方式二：上传Word模板。上传包含三级目录的Word文档（.docx格式），系统将自动提取目录结构。

（3） 方式三：手动输入目录（不推荐）。按照指定格式手动输入文档目录。

### 1.5.3 编辑目录结构
在第二步中，可以对生成或上传的目录结构进行编辑调整，确认无误后进入下一步。

### 1.5.4 选择知识库（可选）
如果有相关知识库，可以选择对应的知识库作为内容参考，提高文档生成质量。

### 1.5.5 提交生成任务
确认所有信息无误后，点击"提交任务"按钮，系统将开始自动生成文档。

### 1.5.6 查看任务进度
在"我的任务"页面可以实时查看文档生成进度，包括：
- 已处理段落数量
- 已生成段落数量
- 处理耗时
- 错误信息（如有）

### 1.5.7 下载文档
任务完成后，可以在任务详情页面下载生成的Word文档。

## 1.6 高级功能

### 1.6.1 批注功能
在Word模板中使用批注功能，可以为特定段落添加写作要求：
1. 在需要添加要求的段落添加批注
2. 在批注中详细描述写作要求
3. 上传带有批注的文档模板
4. 系统会根据批注内容智能生成相应段落

### 1.6.2 知识库集成
系统支持知识库功能，可以：
1. 上传相关文档构建知识库
2. 在文档生成时引用知识库内容
3. 提高文档生成的准确性和专业性

### 1.6.3 Mermaid图表支持
系统支持自动识别和生成Mermaid图表，并最终转换为相应的图表插入在文档中：
1. 在文档内容中使用`<mermaid>`标签包裹Mermaid脚本
2. 系统会自动将脚本转换为图表并插入文档
3. 支持多种图表类型（流程图、时序图、ER图等）

## 1.7 文档模板规范

### 1.7.1 目录结构要求
Word模板需要包含三级目录结构：
- 一级标题：对应章节
- 二级标题：对应小节
- 三级标题：对应子小节

### 1.7.2 写作要求描述
在三级标题下可以添加（非必须项）写作要求描述，要求：
- 描述文字不少于10个汉字
- 使用"描述/列出/简述"等动词开头
- 内容具体明确

### 1.7.3 批注使用
使用Word批注功能为段落添加详细要求，一般用于对已经生成的Word文档让 AI 进行修改：
1. 选中需要添加要求的段落
2. 添加批注
3. 在批注中详细描述写作要求

### 1.7.4 Mermaid图表使用
系统会自动在文档中嵌入Mermaid图表：
1. 使用`<mermaid>`标签包裹Mermaid脚本
2. 系统会自动识别并转换为图表
3. 示例：
```html
<mermaid>
graph TD
    A[开始] --> B[处理]
    B --> C[结束]
</mermaid>
```


## 1.8 并行处理机制

系统采用多线程并行处理机制提高文档生成效率：
- 自动根据系统资源（CPU核心数、内存使用情况）动态调整工作线程数
- 默认最大线程数为16，最小为2
- 支持任务超时控制（默认300秒）
- 实时进度跟踪和预估剩余时间显示

## 1.9 任务管理

### 1.9.1 查看任务列表
在"我的写作任务"页面可以查看所有文档生成任务：
- 任务状态（进行中/已完成/失败）
- 文档标题和创建时间
- 处理进度和详细信息
- 下载生成的文档

### 1.9.2 任务状态说明
- **进行中**：任务正在执行，可查看实时进度
- **已完成**：任务成功完成，可下载文档
- **失败**：任务执行失败，可查看错误信息

### 1.9.3 任务删除
可以删除不需要的任务记录，系统会同时清理相关的临时文件。

## 1.10 常见问题

### 1.10.1 文档生成失败怎么办？
- 检查网络连接是否正常
- 确认输入信息是否完整
- 查看错误日志了解具体原因
- 联系系统管理员

### 1.10.2 生成内容质量不高怎么办？
- 提供更详细的写作要求
- 选择相关知识库作为参考
- 调整关键词和文档类型

### 1.10.3 如何提高生成效率？
- 使用规范的文档模板（Word文档中可识别的三级目录结构, word navigator 中可显示的目录）
- 提供清晰的写作要求（要求越具体写作质量越高）
- 合理使用知识库功能（与写作人物相关度高，不是越多越好）

### 1.10.4 Mermaid图表无法生成怎么办？
- 检查Mermaid 脚本渲染服务器的状态
- 确认标签格式是否为`<mermaid>...</mermaid>`
- 查看系统日志了解具体错误信息（目前部分功能还不稳定，后续进一步提升）

## 1.11 系统维护

### 1.11.1 任务管理
- 系统会自动清理超过2小时未完成的任务（一般上百页（每页1500字）的任务不超过10分钟）
- 用户可以手动删除不需要的任务

### 1.11.2 知识库管理
- 支持知识库的创建、删除和文件管理
- 支持多种格式文件上传（docx、pdf、txt），注意由于底层组建限制，无法上传 doc 格式文件
- 系统自动进行文件去重处理
- 支持文件批量上传

### 1.11.3 用户管理
- 支持用户注册和权限管理
- 不同用户角色具有不同操作权限

## 1.11.4 技术支持

如在使用过程中遇到问题，请联系系统管理员(535139069@qq.com)或查看系统日志获取更多信息。