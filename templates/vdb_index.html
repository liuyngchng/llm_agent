<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>知识库配置</title>
    <meta charset="utf-8">
    <meta id="vdb_index.html">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/vdb.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-database"></i> 知识库配置</h1>
            <p>构建专业文档知识库，提升大模型输出质量</p>
        </header>
        <!-- 第一步：知识库管理 -->
        <div class="content-section">
            <h2><i class="fas fa-database"></i> 知识库管理</h2>
            <div class="knowledge-base-manager">
                <div class="kb-controls">
                    <div class="kb-select-container">
                        <select id="kb_selector">
                            <option value="">--选择知识库--</option>
                            <!-- 知识库选项将通过JS动态加载 -->
                        </select>
                        <span class="or-divider">或</span>
                        <input type="text" id="kb_name" class="search-input" placeholder="输入新知识库名称">
                        <!-- 新增公开选项 -->
                        <div class="visibility-option">
                            <input type="checkbox" id="public_checkbox">
                            <label for="public_checkbox">公开</label>
                        </div>
                        <button class="btn btn-primary" id="createKB">
                            <i class="fas fa-plus-circle"></i> 创建知识库
                        </button>
                    </div>
                    <div id="kb_status" class="status-container" style="display:none">
                        <i class="fas fa-check-circle"></i>
                        <span>知识库创建成功</span>
                    </div>
                </div>

                <div class="kb-status-area">
                    <div class="kb-status-info">
                        <strong>当前知识库状态:</strong>
                        <span id="vdb_status_desc">{{vdb_status}}</span>
                    </div>
                    <button class="btn btn-activate" id="setDefaultBtn" style="display: none;">
                        <i class="fas fa-star"></i> 设置为默认
                    </button>
                    <button class="btn btn-danger" id="deleteBtn" style="display: none;">
                        <i class="fas fa-trash-alt"></i> 删除知识库
                    </button>
                </div>
                <div id="fileListContainer" style="margin-top: 20px; display: none;">
                    <h3><i class="fas fa-file-alt"></i> 知识库文件列表</h3>
                    <table id="fileListTable" class="result-table">
                        <thead>
                            <tr>
                                <th>文件ID</th>
                                <th>文件名</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 文件列表将通过JS动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- 第二步：文档上传（默认隐藏） -->
        <div id="step2" class="hidden">
            <div class="content-section">


                <h2><i class="fas fa-file-upload"></i> 文档上传</h2>
                <div class="input-group">
                    <input type="file" id="fileInput" accept=".pdf,.docx,.txt" style="display:none">
                    <button class="btn btn-primary" id="selectBtn">
                        <i class="fas fa-folder-open"></i> 选择文档
                    </button>
                    <div id="fileName">未选择文件</div>
                    <button class="btn btn-primary" id="startBtn">
                        <i class="fas fa-cloud-upload-alt"></i> 上传构建
                    </button>
                </div>

                <div class="progress-display">
                    <div class="progress-text">
                        <i class="fas fa-info-circle"></i>
                        <span id="textProgress">请选择文档并点击上传按钮开始构建知识库</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressFill"></div>
                    </div>
                </div>

                <div id="stream_output">
                    <div class="status-container">
                        <i class="fas fa-sync-alt"></i>
                        <span>文档索引构建进度将在此处实时展示</span>
                    </div>
                </div>

                <div class="search-section">
                    <h2><i class="fas fa-search"></i> 知识库测试</h2>
                    <div class="search-input-group">
                        <input type="text" id="search_input" class="search-input" placeholder="请输入检索文本，测试上传文档是否可以被命中">
                        <button class="btn btn-primary" id="search_btn">
                            <i class="fas fa-search"></i> 测试
                        </button>
                    </div>
                    <div id="search_status"></div>
                    <div id="search_result_table"></div>
                </div>
                <div class="info-box">
                    <h3><i class="fas fa-lightbulb"></i> 系统能力</h3>
                    <p>系统提供3种文档的知识库构建：</p>
                    <ul>
                        <li>支持上传PDF（非扫描版）、Word（docx）和TXT文件，由模型按照语义进行向量化</li>
                        <li>可自定义向量化过程中的文本块大小，以及文本重叠量</li>
                        <li>支持文档检索测试，验证知识库构建效果</li>
                    </ul>
                </div>

                <div class="info-box">
                    <h3><i class="fas fa-cogs"></i> 系统设计</h3>
                    <p>系统设计详见：<a href="https://nipj5983sr.fklzl.cnpc.com.cn/docx/doxgtEu8WXVSegtJpckpBeR5wdd" target="_blank">文档生成系统设计</a></p>
                </div>
            </div>
        </div>
        <footer>
            <p>© 2025 文档生成平台 | KLSZ</p>
        </footer>
    </div>

    <input type="hidden" id="uid" name="uid" value="{{uid}}">
    <input type="hidden" id="t" name="t" value="{{t}}">
    <script type="text/javascript" src="/static/vdb.js?a=111"></script>
</body>
</html>