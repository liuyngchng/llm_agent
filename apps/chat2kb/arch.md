# 知识库问答系统架构文档

## 1. 项目概述

知识库问答系统是基于大语言模型（LLM）的智能问答服务，支持用户上传文档构建知识库，并通过自然语言提问获取相关知识库中的答案。系统采用Flask框架实现HTTP服务，支持多用户并发访问。

## 2. 系统架构

### 2.1 整体架构

系统采用分层架构设计，主要分为以下层次：

1. **前端层**：提供用户界面，支持文档上传、知识库管理和问答交互。
2. **服务层**：基于Flask框架实现HTTP接口，处理用户请求并调用后端逻辑。
3. **逻辑层**：包括知识库管理、问答处理和用户会话管理。
4. **数据层**：存储知识库文档、向量化数据和用户会话信息。

### 2.2 核心模块

#### 2.2.1 应用模块

- **app.py**：主程序入口，负责初始化Flask应用、注册路由和启动后台任务。
- **chat_agent.py**：封装问答逻辑，调用大语言模型生成答案。

#### 2.2.2 公共组件

- **auth_bp**：用户认证模块，管理用户登录和会话状态。
- **vdb_bp**：知识库管理模块，支持文档上传、向量化和检索。

### 2.3 数据存储

- **SQLite配置数据库**：存储知识库元数据和用户会话信息。
- **向量数据库**：存储文档向量化数据，支持快速检索。
- **本地文件存储**：存储上传的文档和日志文件。

## 3. 功能流程

1. **文档上传**：用户上传文档后，系统将文档向量化并存储到向量数据库中。
2. **问答处理**：用户提问时，系统检索相关文档片段并调用大语言模型生成答案。
3. **会话管理**：系统维护用户会话状态，确保问答过程的连续性和安全性。

## 4. 技术栈

- **Python 3.12**：主要开发语言。
- **Flask**：轻量级Web框架。
- **LangChain**：大语言模型集成框架。
- **SQLite**：轻量级配置数据库。
- **Chroma** ：用于高效检索文档的向量数据库。

## 5. 安全设计

- **用户认证**：通过会话密钥验证用户身份。
- **输入验证**：对所有输入数据进行严格验证。
- **日志审计**：记录所有操作日志，支持安全审计。

## 6. 性能优化

- **异步处理**：支持多线程和异步任务处理。
- **缓存机制**：对频繁访问的数据进行缓存。

## 7. 扩展性

系统支持以下扩展方向：

1. **新增知识库类型**：支持更多文档格式和向量化算法。
2. **多语言支持**：扩展接口层以支持多语言调用。
3. **分布式部署**：通过微服务架构实现水平扩展。

## 8. 未来计划

1. **增强问答能力**：优化大语言模型提示词，提升答案质量。
2. **支持更多文档格式**：扩展文档上传功能，支持PDF、PPT等格式。
3. **优化性能**：进一步优化向量检索和模型推理性能。