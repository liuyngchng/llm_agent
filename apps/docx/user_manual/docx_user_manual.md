<center><h1>文档生成系统用户使用手册</h1></center>


# 1. 系统简介

文档生成系统是一个基于人工智能的自动化文档生成平台，能够根据用户提供的文档结构和内容要求，自动生成各类文档。系统支持多种输入方式，包括自动生成目录结构、上传Word模板以及基于批注的文档修改等功能。

# 2. 功能特性

（1）支持自动生成文档目录结构；

（2）支持 `Word` 模板上传和处理；

（3）支持段落批注智能处理；

（4）集成知识库向量检索功能；

（5）支持 `Mermaid` 图表自动生成；

（6）实时进度跟踪和任务管理。

# 3. 客户端系统要求
 本地计算机安装有 `Chrome` 浏览器，使用浏览器访问服务地址即可。

# 4. 服务端系统要求
系统支持用户部署在自己的本地计算机上，本地化部署需要具备以下条件。

## 4.1 软件依赖
```bash
# 操作系统
ubuntu 24.04 LTS
# 运行环境
python 3.12.3
# 容器环境
Docker version 27.5.1
# 依赖的组件
pip install python-docx cairosvg flask chromadb openai langchain
# mermaid server
kroki-mermaid
# 可访问的 LLM API， 例如 deepseek API
base api: https://your_llm_open_ai_compatible_api_server/vi
api token: sk *******
```


## 4.2 字体支持（中文）
```bash
# 安装常用的中文字体包
sudo apt update
sudo apt install fonts-wqy-microhei fonts-wqy-zenhei fonts-noto-cjk

# 安装字体工具
sudo apt install fontconfig

# 刷新字体缓存
fc-cache -fv
```


# 5. 使用流程

## 5.1 登录系统
访问系统登录页面，输入用户名和密码进行身份验证。首次使用需要先注册账户。

## 5.2 创建新文档任务
系统主界面下可以创建文档生成任务。

### 5.2.1 填写基本信息
（1）**文档类型**【必填项】。选择文档类型（如可行性研究报告、技术方案等）。

（2）**文档标题**【必填项】。输入文档标题。

（3）**关键词**【可选项】。输入文档相关的关键词或特殊要求，例如每个小节需要写多少字，或者需要更多的目录层级等。

### 5.2.2 选择目录生成方式
系统支持三种目录生成方式。

（1） 系统自动生成。 系统根据文档类型和标题智能生成三级目录结构。

（2） 上传Word模板。上传包含三级目录的Word文档（注意，必须为`.docx`格式，不支持 `.doc` 格式），系统将自动提取目录结构以及写作要求（如果有的话）。

（3） 手动修改目录。在方式一自动生成的基础上，按照示范格式手动修改文档目录，然后提交。

## 5.3 编辑目录结构
在第二步中，可以对生成或上传的目录结构进行编辑调整，确认无误后进入下一步。

## 5.4 选择知识库（可选）
如果有相关知识库，可以选择对应的知识库作为内容参考，知识库可以显著提高文档的生成质量。

## 5.5 提交生成任务
确认所有信息无误后，点击"提交任务"按钮，系统将开始自动创建生成文档任务。

## 5.6 查看任务进度
在"我的任务"页面可以实时查看文档生成进度，包括：

（1）总体进度百分比；

（2）已处理段落数量；

（3）已生成段落数量；

（4）处理耗时；

（5）错误信息（如有）。

## 5.7 下载文档
可以在任务详情页面随时下载生成的 `Word` 文档，包括在写作尚未完成之前。

# 6. 高级功能

## 6.1 批注处理功能
在 `Word` 模板中使用批注功能，可以为特定段落添加写作（修改）要求。

（1）在需要添加要求的段落添加批注；

（2）在批注中详细描述写作（修改）要求；

（3）上传带有批注的文档模板；

（4）系统会根据批注内容智能生成（修改）相应段落内容。

## 6.2 知识库集成
系统支持知识库管理功能，具有以下能力。

（1）上传相关文档（PDF、 txt、docx）构建知识库；

（2）在文档生成时会参考相关的知识库内容；

（3）通过参考知识库中的相关内容，提高生成文档内容的准确性和专业性。

## 6.3 图表支持
系统在写作过程中，会自动插入图表。

（1）在文档内容中使用 `<mermaid>`标签包裹 `Mermaid` 脚本；

（2）系统会自动将脚本转换为图表并插入文档；

（3）支持多种图表类型（流程图、时序图、`ER` 图等）。

# 7. 文档模板规范

## 7.1 目录结构要求
Word模板需要包含三级目录结构，如下所示。

（1）一级标题：对应章节；

（2）二级标题：对应小节；

（3）三级标题：对应子小节；

也可以提供更多的目录层级，例如四级、五级等。

## 7.2 写作要求描述
在最低一级标题下可以添加（非必须项）写作要求描述，写作要求需要达到以下标准。

（1）描述文字不少于10个汉字。

（2）使用"描述/列出/简述"等动词开头。

（3）内容具体明确。

## 7.3 批注使用
使用 `Word` 批注功能为段落添加详细要求，一般用于对已经生成的`Word`文档让 `AI` 进行修改：

（1）选中需要添加要求的段落；

（2）添加批注；

（3）在批注中详细描述写作要求。


# 8. 并行处理机制

系统采用多线程并行处理机制提高文档生成效率。

（1）自动根据系统资源（CPU核心数、内存使用情况）动态调整工作线程数；

（2）默认最大线程数为16，最小为2；

（3）支持任务超时控制（默认300秒）；

（4）实时进度跟踪和预估剩余时间显示。

# 9. 任务管理

## 9.1 查看任务列表
在"我的写作任务"页面可以查看所有文档生成任务。

（1）任务状态（进行中/已完成/失败）；

（2）文档标题和创建时间；

（3）处理进度和详细信息；

（4）下载生成的文档；

## 9.2 任务状态说明
（1）**进行中**：任务正在执行，可查看实时进度百分比；

（2）**已完成**：任务成功完成，可下载文档；

（3）**失败**：任务执行失败，可查看错误信息。

## 9.3 任务删除
可以删除不需要的任务记录，系统会同时清理相关的临时文件。

# 10. 常见问题

## 10.1 文档生成失败怎么办？
（1）检查网络连接是否正常；

（2）所使用的大语言模型 API 是否可正常访问；

（3）确认输入信息是否完整；

（4）查看错误日志了解具体原因；

（5）联系系统管理员。

## 10.2 生成内容质量不高怎么办？
（1）提供更详细的写作要求

（2）选择相关知识库作为参考

（3）调整关键词和文档类型

## 10.3 如何提高生成效率？
（1）使用规范的文档模板（Word文档中可识别的多级目录结构, word 导航中可显示的目录）

（2）提供清晰的写作要求（要求越具体写作质量越高）

（3）合理使用知识库功能（与写作人物相关度高，不是越多越好）

## 10.4 图表无法生成怎么办？
（1）检查Mermaid 脚本渲染服务器的状态；

（2）确认标签格式是否为`<mermaid>...</mermaid>`；

（3）查看系统日志了解具体错误信息（目前部分功能还不稳定，后续进一步提升）。

# 11. 系统维护

## 11.1 任务管理
（1）系统会自动清理超过2小时未完成的任务，一般上百页（每页1500字）的任务处理时间不超过10分钟。

（2）用户可以手动删除不需要的任务。

## 11.2 知识库管理
（1）支持知识库的创建、删除和文件管理；

（2）支持多种格式文件上传（docx、pdf、txt），注意由于底层组建限制，无法上传 doc 格式文件；

（3）系统自动根据文件内容进行文件去重处理；

（4）支持文件批量上传。

## 11.3 用户管理
（1）支持用户注册和权限管理；

（2）不同用户角色具有不同操作权限。

## 11.4 技术支持

如在使用过程中遇到问题，请联系系统管理员或查看系统日志获取更多信息。