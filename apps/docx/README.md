这是一个基于人工智能的在线文档生成系统，能够根据用户提供的文档结构和内容要求，自动生成各类专业文档。

# 1. 系统简介

文档生成系统是一个基于大语言模型(`LLM`)的自动化文档生成平台，能够根据用户提供的文档结构和内容要求，自动生成各类文档。系统支持多种输入方式，包括自动生成目录结构、上传Word模板以及基于批注的文档修改等功能。

# 2. 功能特性

- **智能文档生成**: 支持自动生成文档目录结构
- **模板处理**: 支持Word模板上传和处理
- **批注处理**: 支持段落批注智能处理
- **知识库集成**: 集成知识库向量检索功能，提高文档质量
- **图表支持**: 支持Mermaid图表自动生成
- **实时进度跟踪**: 提供任务管理和进度监控
- **并行处理**: 采用多线程并行处理机制提高生成效率

# 3. 技术架构

## 3.1 核心组件

- [app.py](../../apps/csm/app.py): 主应用入口，包含Flask路由和业务逻辑
- [doc_writer.py](../../apps/docx/doc_writer.py): Word文档生成器核心模块
- [txt_gen_util.py](../../apps/docx/txt_gen_util.py): 文本生成工具，负责调用`LLM`生成内容
- [mermaid_render.py](../../apps/docx/mermaid_render.py): `Mermaid`图表渲染处理
- 前端模板: `templates/`目录下的HTML模板文件
- 静态资源: `static/`目录下的`CSS`、`JavaScript`文件

## 3.2 主要依赖

- Python 3.12+
- Flask (Web框架)
- `python-docx` (Word文档处理)
- `langchain`/`openai` (`LLM`集成)
- `chromadb` (向量数据库)
- `cairosvg` (图表渲染)

# 4. 使用流程

（1）**登录系统**: 访问登录页面，进行身份验证

（2）**创建文档任务**: 填写文档类型、标题等基本信息，选择目录生成方式(自动生成/模板上传/手动编辑)

（3）**编辑目录结构**: 调整生成或上传的目录结构

（4）**选择知识库**: 选用相关知识库作为内容参考(可选)

（5）**提交生成任务**: 确认信息后提交文档生成任务

（6）**监控进度**: 在"我的任务"页面查看实时进度

（7）**下载文档**: 任务完成后下载生成的Word文档

# 5. 高级功能

## 5.1 批注处理

在Word模板中使用批注功能，为特定段落添加写作(修改)要求，系统会根据批注内容智能生成相应段落。

## 5.2 知识库集成

支持上传`PDF`、`txt`、`docx`等文档构建知识库，在文档生成时参考相关内容，提高生成质量。

## 5.3 图表支持

在文档内容中使用`<mermaid>`标签包裹Mermaid脚本，系统会自动转换为图表并插入文档。

# 6. 部署要求

## 6.1 服务端要求
- `Ubuntu 20.04+` 或类似Linux发行版
- Python 3.12+
- Docker (推荐)
- 可访问的`LLM` `API`服务

## 6.2 客户端要求
- 现代浏览器(推荐Chrome)

# 7. 目录结构

```shell
apps/docx/
├── app.py                 # 主应用文件
├── doc_writer.py          # 文档写入器
├── txt_gen_util.py        # 文本生成工具
├── mermaid_render.py      # 图表渲染器
├── templates/             # HTML模板
├── static/                # 静态资源文件
├── user_manual/           # 用户手册
└── build/                 # 构建脚本
```

# 8. 开发指南

## 8.1 核心模块说明

（1）**文档生成流程控制** ([app.py](../../apps/csm/app.py)): 处理HTTP请求，协调各模块工作；

（2）**文档写入引擎** ([doc_writer.py](../../apps/docx/doc_writer.py)): 负责Word文档的实际生成操作；

（3）**文本内容生成** ([txt_gen_util.py](../../apps/docx/txt_gen_util.py)): 调用LLM生成段落文本内容；

（4）**前端交互** ([static/*.js](../../apps/csm/static/csm.js), [templates/*.html](../../apps/csm/templates/csm_index.html)): 提供用户界面和交互体验。

## 8.2 并行处理机制

系统采用多线程并行处理提高文档生成效率，默认最大线程数为16，最小为2，可根据系统资源动态调整。

# 9. 注意事项

（1）Word模板需符合规范(包含三级目录结构)；

（2）推荐使用`.docx`格式，不支持旧版`.doc`格式；

（3）系统需要稳定的网络连接以访问`LLM`服务；

（4）生成质量和效果依赖于所使用的`LLM`能力和提示词设计。